<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCP/UDPè°ƒè¯•å·¥å…· - Webç‰ˆ</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        .panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .panel-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .form-row label {
            min-width: 80px;
            color: #555;
        }
        select, input[type="text"], input[type="number"] {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        select {
            min-width: 250px;
        }
        input[type="text"], input[type="number"] {
            min-width: 150px;
        }
        button {
            padding: 8px 16px;
            background: #1890ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        button:hover {
            background: #40a9ff;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        button.secondary {
            background: #52c41a;
        }
        button.secondary:hover {
            background: #73d13d;
        }
        button.danger {
            background: #ff4d4f;
        }
        button.danger:hover {
            background: #ff7875;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            margin-left: 10px;
        }
        .status.connected {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }
        .status.disconnected {
            background: #fff1f0;
            color: #ff4d4f;
            border: 1px solid #ffa39e;
        }
        .mode-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        .mode-selector label {
            display: flex;
            align-items: center;
            cursor: pointer;
            min-width: auto;
        }
        .mode-selector input {
            margin-right: 5px;
        }
        .data-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 900px) {
            .data-area {
                grid-template-columns: 1fr;
            }
        }
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            resize: vertical;
        }
        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .checkbox-group input {
            margin-right: 5px;
        }
        .history-list {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
        }
        .history-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-item:hover {
            background: #f5f5f5;
        }
        .history-item:last-child {
            border-bottom: none;
        }
        .remark {
            color: #1890ff;
            font-size: 12px;
        }
        .client-list {
            max-height: 100px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
            margin-top: 10px;
        }
        .client-item {
            padding: 5px 10px;
            cursor: pointer;
        }
        .client-item:hover {
            background: #f5f5f5;
        }
        .client-item.selected {
            background: #e6f7ff;
        }
        #receiveArea {
            background: #fafafa;
        }
        .error {
            color: #ff4d4f;
            padding: 10px;
            background: #fff1f0;
            border: 1px solid #ffa39e;
            border-radius: 4px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ TCP/UDPè°ƒè¯•å·¥å…· - Webç‰ˆ</h1>
        
        <!-- ç½‘ç»œé…ç½® -->
        <div class="panel">
            <div class="panel-title">ç½‘ç»œé…ç½®</div>
            <div class="form-row">
                <label>ç½‘å¡/IP:</label>
                <select id="interfaceSelect">
                    <option value="">è¯·é€‰æ‹©ç½‘å¡</option>
                </select>
                <button onclick="refreshInterfaces()">åˆ·æ–°</button>
            </div>
            <div class="mode-selector">
                <label>åè®®:</label>
                <label>
                    <input type="radio" name="protocol" value="TCP" checked onchange="switchProtocol()">
                    TCP
                </label>
                <label>
                    <input type="radio" name="protocol" value="UDP" onchange="switchProtocol()">
                    UDP
                </label>
                <label style="margin-left: 20px;">æ¨¡å¼:</label>
                <label>
                    <input type="radio" name="mode" value="client" checked onchange="switchMode()">
                    å®¢æˆ·ç«¯æ¨¡å¼
                </label>
                <label>
                    <input type="radio" name="mode" value="server" onchange="switchMode()">
                    æœåŠ¡å™¨æ¨¡å¼
                </label>
            </div>
        </div>
        
        <!-- è¿æ¥é…ç½® -->
        <div class="panel">
            <div class="panel-title">è¿æ¥é…ç½®</div>
            
            <!-- å®¢æˆ·ç«¯æ¨¡å¼ -->
            <div id="clientConfig">
                <div class="form-row">
                    <label>å†å²:</label>
                    <select id="connHistorySelect" onchange="onConnectionHistorySelect()">
                        <option value="">é€‰æ‹©å†å²è¿æ¥</option>
                    </select>
                </div>
                <div class="form-row">
                    <label>ç›®æ ‡IP:</label>
                    <input type="text" id="targetIp" placeholder="127.0.0.1" value="127.0.0.1">
                    <label>ç«¯å£:</label>
                    <input type="number" id="targetPort" placeholder="8080" value="8080">
                    <button onclick="saveConnection()">ä¿å­˜</button>
                    <button id="connectBtn" onclick="toggleConnection()">è¿æ¥</button>
                    <span id="clientStatus" class="status disconnected">æœªè¿æ¥</span>
                </div>
            </div>
            
            <!-- æœåŠ¡å™¨æ¨¡å¼ -->
            <div id="serverConfig" style="display: none;">
                <div class="form-row">
                    <label>ç›‘å¬ç«¯å£:</label>
                    <input type="number" id="listenPort" placeholder="8080" value="8080">
                    <button id="serverBtn" onclick="toggleServer()">å¯åŠ¨æœåŠ¡å™¨</button>
                    <span id="serverStatus" class="status disconnected">æœªå¯åŠ¨</span>
                </div>
                <div id="clientListContainer" style="display: none;">
                    <label>å·²è¿æ¥å®¢æˆ·ç«¯:</label>
                    <div id="clientList" class="client-list"></div>
                </div>
            </div>
        </div>
        
        <!-- æ•°æ®æ”¶å‘ -->
        <div class="data-area">
            <!-- æ¥æ”¶åŒº -->
            <div class="panel">
                <div class="panel-title">æ¥æ”¶æ•°æ®</div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="showHex" checked> åå…­è¿›åˆ¶æ˜¾ç¤º
                    </label>
                </div>
                <textarea id="receiveArea" readonly placeholder="æ¥æ”¶åˆ°çš„æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                <div class="form-row">
                    <button id="pauseBtn" onclick="toggleReceivePause()">æš‚åœæ¥æ”¶</button>
                    <span id="pauseBadge" class="badge" style="display: none; margin-left: 10px; background: #f59e0b; color: white;">å·²æš‚åœ (0 æ¡)</span>
                    <button onclick="clearReceive()">æ¸…ç©º</button>
                </div>
            </div>
            
            <!-- å‘é€åŒº -->
            <div class="panel">
                <div class="panel-title">å‘é€æ•°æ®</div>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="sendHex" checked> åå…­è¿›åˆ¶å‘é€
                    </label>
                    <label>
                        <input type="checkbox" id="saveHistory"> ä¿å­˜åˆ°å†å²
                    </label>
                </div>
                <textarea id="sendArea" placeholder="è¾“å…¥è¦å‘é€çš„æ•°æ®..."></textarea>
                <div class="form-row">
                    <button class="secondary" onclick="sendData()">å‘é€</button>
                    <button onclick="clearSend()">æ¸…ç©º</button>
                </div>
                
                <!-- å‘é€å†å² -->
                <div style="margin-top: 15px;">
                    <div class="panel-title" style="font-size: 14px;">å‘é€å†å²</div>
                    <div id="historyList" class="history-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Socket.IOè¿æ¥
        const socket = io();
        
        // çŠ¶æ€
        let isConnected = false;
        let isServerRunning = false;
        let selectedClient = null;
        let connectionHistory = [];
        let udpConnectionHistory = [];
        let sendHistory = [];
        let currentProtocol = 'TCP';
        let udpConnected = false;
        let udpServerRunning = false;
        
        // è¿æ¥æˆåŠŸ
        socket.on('connect', function() {
            console.log('Connected to server');
        });
        
        // ç½‘å¡åˆ—è¡¨
        socket.on('interfaces', function(interfaces) {
            const select = document.getElementById('interfaceSelect');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©ç½‘å¡</option>';
            interfaces.forEach(function(iface) {
                const option = document.createElement('option');
                option.value = iface.ip;
                option.textContent = `${iface.name} (${iface.ip})`;
                select.appendChild(option);
            });
            if (interfaces.length > 0) {
                select.selectedIndex = 1;
            }
        });
        
        // è¿æ¥å†å²
        socket.on('connection_history', function(history) {
            connectionHistory = history;
            updateConnectionHistorySelect();
        });
        
        // UDPè¿æ¥å†å²
        socket.on('udp_connection_history', function(history) {
            udpConnectionHistory = history;
            if (currentProtocol === 'UDP') {
                updateConnectionHistorySelect();
            }
        });
        
        // å‘é€å†å²
        socket.on('send_history', function(history) {
            sendHistory = history;
            updateSendHistoryList();
        });
        
        // è¿æ¥çŠ¶æ€
        socket.on('connection_status', function(status) {
            isConnected = status.connected;
            const btn = document.getElementById('connectBtn');
            const statusSpan = document.getElementById('clientStatus');
            
            if (isConnected) {
                btn.textContent = 'æ–­å¼€';
                btn.className = 'danger';
                statusSpan.textContent = 'å·²è¿æ¥';
                statusSpan.className = 'status connected';
            } else {
                btn.textContent = 'è¿æ¥';
                btn.className = '';
                statusSpan.textContent = 'æœªè¿æ¥';
                statusSpan.className = 'status disconnected';
            }
        });
        
        // æœåŠ¡å™¨çŠ¶æ€
        socket.on('server_status', function(status) {
            isServerRunning = status.running;
            const btn = document.getElementById('serverBtn');
            const statusSpan = document.getElementById('serverStatus');
            const clientListContainer = document.getElementById('clientListContainer');
            
            if (isServerRunning) {
                btn.textContent = 'åœæ­¢æœåŠ¡å™¨';
                btn.className = 'danger';
                statusSpan.textContent = 'è¿è¡Œä¸­ ' + (status.address || '');
                statusSpan.className = 'status connected';
                clientListContainer.style.display = 'block';
            } else {
                btn.textContent = 'å¯åŠ¨æœåŠ¡å™¨';
                btn.className = '';
                statusSpan.textContent = 'æœªå¯åŠ¨';
                statusSpan.className = 'status disconnected';
                clientListContainer.style.display = 'none';
                document.getElementById('clientList').innerHTML = '';
            }
        });
        
        // æ¥æ”¶æš‚åœçŠ¶æ€
        let isReceivePaused = false;
        let pausedDataBuffer = [];
        
        // æ¥æ”¶æ•°æ®
        socket.on('receive_data', function(data) {
            if (isReceivePaused) {
                // å¦‚æœæš‚åœï¼Œå°†æ•°æ®å­˜å…¥ç¼“å†²åŒº
                pausedDataBuffer.push(data);
                updatePauseBadge();
                return;
            }
            
            const area = document.getElementById('receiveArea');
            let text = data.data;
            if (data.from) {
                text = `[æ¥è‡ª ${data.from}]\n${text}`;
            }
            area.value += text;
            area.scrollTop = area.scrollHeight;
        });
        
        // åˆ‡æ¢æ¥æ”¶æš‚åœçŠ¶æ€
        function toggleReceivePause() {
            isReceivePaused = !isReceivePaused;
            const btn = document.getElementById('pauseBtn');
            const badge = document.getElementById('pauseBadge');
            
            if (isReceivePaused) {
                btn.textContent = 'ç»§ç»­æ¥æ”¶';
                btn.className = 'secondary';
                badge.style.display = 'inline-block';
                updatePauseBadge();
            } else {
                btn.textContent = 'æš‚åœæ¥æ”¶';
                btn.className = '';
                badge.style.display = 'none';
                // æ¢å¤æ˜¾ç¤ºç¼“å†²çš„æ•°æ®
                const area = document.getElementById('receiveArea');
                pausedDataBuffer.forEach(function(data) {
                    let text = data.data;
                    if (data.from) {
                        text = `[æ¥è‡ª ${data.from}]\n${text}`;
                    }
                    area.value += text;
                });
                area.scrollTop = area.scrollHeight;
                pausedDataBuffer = [];
            }
        }
        
        // æ›´æ–°æš‚åœå¾½ç« 
        function updatePauseBadge() {
            const badge = document.getElementById('pauseBadge');
            if (badge && isReceivePaused) {
                badge.textContent = `å·²æš‚åœ (${pausedDataBuffer.length} æ¡)`;
            }
        }
        
        // å‘é€æˆåŠŸ
        socket.on('send_success', function(data) {
            const area = document.getElementById('receiveArea');
            area.value += data.data;
            area.scrollTop = area.scrollHeight;
        });
        
        // æœåŠ¡å™¨å®¢æˆ·ç«¯è¿æ¥
        socket.on('server_client_connected', function(data) {
            updateClientList();
        });
        
        // æœåŠ¡å™¨å®¢æˆ·ç«¯æ–­å¼€
        socket.on('server_client_disconnected', function(data) {
            updateClientList();
        });
        
        // UDPè¿æ¥çŠ¶æ€
        socket.on('udp_connection_status', function(status) {
            udpConnected = status.connected;
            const btn = document.getElementById('connectBtn');
            const statusSpan = document.getElementById('clientStatus');
            
            if (udpConnected) {
                btn.textContent = 'æ–­å¼€';
                btn.className = 'danger';
                statusSpan.textContent = 'å·²è¿æ¥(UDP)';
                statusSpan.className = 'status connected';
            } else {
                btn.textContent = 'è¿æ¥';
                btn.className = '';
                statusSpan.textContent = 'æœªè¿æ¥';
                statusSpan.className = 'status disconnected';
            }
        });
        
        // UDPæœåŠ¡å™¨çŠ¶æ€
        socket.on('udp_server_status', function(status) {
            udpServerRunning = status.running;
            const btn = document.getElementById('serverBtn');
            const statusSpan = document.getElementById('serverStatus');
            
            if (udpServerRunning) {
                btn.textContent = 'åœæ­¢æœåŠ¡å™¨';
                btn.className = 'danger';
                statusSpan.textContent = 'è¿è¡Œä¸­(UDP) ' + (status.address || '');
                statusSpan.className = 'status connected';
            } else {
                btn.textContent = 'å¯åŠ¨æœåŠ¡å™¨';
                btn.className = '';
                statusSpan.textContent = 'æœªå¯åŠ¨';
                statusSpan.className = 'status disconnected';
            }
        });
        
        // é”™è¯¯
        socket.on('error', function(data) {
            alert('é”™è¯¯: ' + data.message);
        });
        
        // åˆ·æ–°ç½‘å¡
        function refreshInterfaces() {
            socket.emit('get_interfaces');
        }
        
        // åˆ‡æ¢åè®®
        function switchProtocol() {
            currentProtocol = document.querySelector('input[name="protocol"]:checked').value;
            updateConnectionHistorySelect();
            
            // å¦‚æœå½“å‰æœ‰è¿æ¥ï¼Œæ–­å¼€
            if (isConnected && currentProtocol === 'UDP') {
                toggleConnection();
            }
            if (udpConnected && currentProtocol === 'TCP') {
                toggleConnection();
            }
        }
        
        // åˆ‡æ¢æ¨¡å¼
        function switchMode() {
            const mode = document.querySelector('input[name="mode"]:checked').value;
            document.getElementById('clientConfig').style.display = mode === 'client' ? 'block' : 'none';
            document.getElementById('serverConfig').style.display = mode === 'server' ? 'block' : 'none';
        }
        
        // æ›´æ–°è¿æ¥å†å²ä¸‹æ‹‰æ¡†
        function updateConnectionHistorySelect() {
            const select = document.getElementById('connHistorySelect');
            select.innerHTML = '<option value="">é€‰æ‹©å†å²è¿æ¥</option>';
            const historyList = currentProtocol === 'UDP' ? udpConnectionHistory : connectionHistory;
            historyList.forEach(function(conn, index) {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${conn[0]}:${conn[1]}`;
                select.appendChild(option);
            });
        }
        
        // é€‰æ‹©è¿æ¥å†å²
        function onConnectionHistorySelect() {
            const select = document.getElementById('connHistorySelect');
            const index = parseInt(select.value);
            const historyList = currentProtocol === 'UDP' ? udpConnectionHistory : connectionHistory;
            
            if (index >= 0 && index < historyList.length) {
                const conn = historyList[index];
                const isCurrentlyConnected = currentProtocol === 'UDP' ? udpConnected : isConnected;
                
                // å¦‚æœå·²è¿æ¥ï¼Œç¡®è®¤åˆ‡æ¢
                if (isCurrentlyConnected) {
                    const currentIp = document.getElementById('targetIp').value;
                    const currentPort = document.getElementById('targetPort').value;
                    if (!confirm(`å½“å‰å·²è¿æ¥åˆ° ${currentIp}:${currentPort}\næ˜¯å¦æ–­å¼€å¹¶è¿æ¥åˆ° ${conn[0]}:${conn[1]}?`)) {
                        return;
                    }
                    toggleConnection(); // æ–­å¼€å½“å‰è¿æ¥
                }
                
                document.getElementById('targetIp').value = conn[0];
                document.getElementById('targetPort').value = conn[1];
                
                // è‡ªåŠ¨è¿æ¥
                setTimeout(toggleConnection, 100);
            }
        }
        
        // ä¿å­˜è¿æ¥
        function saveConnection() {
            const ip = document.getElementById('targetIp').value.trim();
            const port = parseInt(document.getElementById('targetPort').value);
            
            if (!ip || !port) {
                alert('è¯·å…ˆå¡«å†™ç›®æ ‡IPå’Œç«¯å£');
                return;
            }
            
            if (currentProtocol === 'UDP') {
                socket.emit('save_udp_connection', {ip: ip, port: port});
            } else {
                socket.emit('save_connection', {ip: ip, port: port});
            }
        }
        
        // åˆ‡æ¢è¿æ¥
        function toggleConnection() {
            if (currentProtocol === 'UDP') {
                // UDPè¿æ¥
                if (udpConnected) {
                    socket.emit('udp_disconnect');
                } else {
                    const ip = document.getElementById('targetIp').value.trim();
                    const port = parseInt(document.getElementById('targetPort').value);
                    
                    if (!ip || !port) {
                        alert('è¯·å¡«å†™ç›®æ ‡IPå’Œç«¯å£');
                        return;
                    }
                    
                    socket.emit('udp_connect', {ip: ip, port: port, local_port: 0, broadcast: false});
                }
            } else {
                // TCPè¿æ¥
                if (isConnected) {
                    socket.emit('client_disconnect');
                } else {
                    const ip = document.getElementById('targetIp').value.trim();
                    const port = parseInt(document.getElementById('targetPort').value);
                    const sourceIp = document.getElementById('interfaceSelect').value || '0.0.0.0';
                    
                    if (!ip || !port) {
                        alert('è¯·å¡«å†™ç›®æ ‡IPå’Œç«¯å£');
                        return;
                    }
                    
                    socket.emit('client_connect', {ip: ip, port: port, source_ip: sourceIp});
                }
            }
        }
        
        // åˆ‡æ¢æœåŠ¡å™¨
        function toggleServer() {
            if (currentProtocol === 'UDP') {
                // UDPæœåŠ¡å™¨
                if (udpServerRunning) {
                    socket.emit('udp_server_stop');
                } else {
                    const port = parseInt(document.getElementById('listenPort').value);
                    const bindIp = document.getElementById('interfaceSelect').value || '0.0.0.0';
                    
                    if (!port) {
                        alert('è¯·å¡«å†™ç›‘å¬ç«¯å£');
                        return;
                    }
                    
                    socket.emit('udp_server_start', {bind_ip: bindIp, port: port});
                }
            } else {
                // TCPæœåŠ¡å™¨
                if (isServerRunning) {
                    socket.emit('server_stop');
                } else {
                    const port = parseInt(document.getElementById('listenPort').value);
                    const bindIp = document.getElementById('interfaceSelect').value || '0.0.0.0';
                    
                    if (!port) {
                        alert('è¯·å¡«å†™ç›‘å¬ç«¯å£');
                        return;
                    }
                    
                    socket.emit('server_start', {bind_ip: bindIp, port: port});
                }
            }
        }
        
        // æ›´æ–°å®¢æˆ·ç«¯åˆ—è¡¨
        function updateClientList() {
            // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥ä»æœåŠ¡å™¨è·å–å®¢æˆ·ç«¯åˆ—è¡¨
        }
        
        // å‘é€æ•°æ®
        function sendData() {
            const data = document.getElementById('sendArea').value.trim();
            const isHex = document.getElementById('sendHex').checked;
            const saveToHistory = document.getElementById('saveHistory').checked;
            
            if (!data) {
                alert('è¯·è¾“å…¥è¦å‘é€çš„æ•°æ®');
                return;
            }
            
            if (currentProtocol === 'UDP') {
                socket.emit('udp_send', {
                    data: data,
                    is_hex: isHex,
                    target_ip: null,
                    target_port: null
                });
            } else {
                socket.emit('send_data', {
                    data: data,
                    is_hex: isHex,
                    save_history: saveToHistory,
                    target_client: selectedClient
                });
            }
        }
        
        // æ›´æ–°å‘é€å†å²åˆ—è¡¨
        function updateSendHistoryList() {
            const container = document.getElementById('historyList');
            container.innerHTML = '';
            
            sendHistory.forEach(function(item, index) {
                const div = document.createElement('div');
                div.className = 'history-item';
                
                const text = document.createElement('span');
                if (item.remark) {
                    text.innerHTML = `<span class="remark">[${item.remark}]</span> ${item.data.substring(0, 30)}${item.data.length > 30 ? '...' : ''}`;
                } else {
                    text.textContent = item.data.substring(0, 50) + (item.data.length > 50 ? '...' : '');
                }
                
                const remarkBtn = document.createElement('button');
                remarkBtn.textContent = 'å¤‡æ³¨';
                remarkBtn.style.padding = '2px 8px';
                remarkBtn.style.fontSize = '12px';
                remarkBtn.onclick = function(e) {
                    e.stopPropagation();
                    addRemark(index);
                };
                
                div.appendChild(text);
                div.appendChild(remarkBtn);
                
                div.onclick = function() {
                    document.getElementById('sendArea').value = item.data;
                };
                
                container.appendChild(div);
            });
        }
        
        // æ·»åŠ å¤‡æ³¨
        function addRemark(index) {
            const remark = prompt('è¯·è¾“å…¥å¤‡æ³¨:');
            if (remark !== null) {
                socket.emit('update_remark', {index: index, remark: remark});
            }
        }
        
        // æ¸…ç©ºæ¥æ”¶åŒº
        function clearReceive() {
            document.getElementById('receiveArea').value = '';
        }
        
        // æ¸…ç©ºå‘é€åŒº
        function clearSend() {
            document.getElementById('sendArea').value = '';
        }
    </script>
</body>
</html>